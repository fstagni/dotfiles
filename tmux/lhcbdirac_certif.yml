session_name: lhcbdirac_certif
windows:
  - window_name: monit
    layout: tiled
    panes:
      - htop
      - shell_command:
        - cd /tmp
        - rm -Rf LHCbDIRACCertif
        - mkdir -p LHCbDIRACCertif/dev && mkdir -p LHCbDIRACCertif/prod
        - cd /tmp/LHCbDIRACCertif/prod
        - conda activate dirac-development
        - git clone git@github.com:DIRACGrid/DIRAC.git
        - cd DIRAC
        - git co rel-v8r0
        - cd /tmp/LHCbDIRACCertif/prod
        - conda activate dirac-development
        - git clone ssh://git@gitlab.cern.ch:7999/lhcb-dirac/LHCbDIRAC.git
        - cd LHCbDIRAC
        - git co master
        - cd /tmp
        - sshpass -f /tmp/.passwd scp fstagni@lxplus.cern.ch:/afs/cern.ch/user/f/fstagni/.globus/usercert.pem .
        - sshpass -f /tmp/.passwd scp fstagni@lxplus.cern.ch:/afs/cern.ch/user/f/fstagni/.globus/userkey.pem .
        - sleep 180
        - docker cp usercert.pem LHCbDIRAC_certif_client:/root/.globus/
        - docker cp userkey.pem LHCbDIRAC_certif_client:/root/.globus/
        - docker cp usercert.pem LHCbDIRAC-prod:/root/.globus/
        - docker cp userkey.pem LHCbDIRAC-prod:/root/.globus/
        - rm -Rf usercert.pem userkey.pem 

  - window_name: dev
    layout: tiled
    panes:
      - shell_command:
        - sleep 10
        - cd /tmp/LHCbDIRACCertif/dev
        - conda activate dirac-development
        - git clone git@github.com:DIRACGrid/DIRAC.git
        - cd DIRAC
        - git co integration
      - shell_command:
        - sleep 10
        - cd /tmp/LHCbDIRACCertif/dev
        - conda activate dirac-development
        - git clone ssh://git@gitlab.cern.ch:7999/lhcb-dirac/LHCbDIRAC.git
        - cd LHCbDIRAC
        - git co devel
  - window_name: clients
    layout: tiled
    panes:
      - shell_command:
        - docker container rm LHCbDIRAC_certif_client
        - sleep 20
        - docker run -it --name LHCbDIRAC_certif_client --mount type=bind,source=/tmp/LHCbDIRACCertif/dev/DIRAC,target=/code/DIRAC --mount type=bind,source=/tmp/LHCbDIRACCertif/dev/LHCbDIRAC,target=/code/LHCbDIRAC -v /cvmfs:/cvmfs:shared almalinux
        - PS1="\[\033[42m\]\[\033[31m\]\u@DEV_CLIENT\[\033[00m\] $ " && export GIT_SSL_NO_VERIFY=1 && mkdir client && cd client && curl -LO https://github.com/DIRACGrid/DIRACOS2/releases/latest/download/DIRACOS-Linux-$(uname -m).sh && bash DIRACOS-Linux-$(uname -m).sh && rm -Rf DIRACOS-Linux-$(uname -m).sh && source diracos/diracosrc && cd .. && pip install -e code/DIRAC/ && pip install -e code/LHCbDIRAC/ && mkdir ~/.globus
        - pip install git+https://gitlab.cern.ch/lhcb-simulation/lbmcsubmit.git
      - shell_command:
        - docker container rm LHCbDIRAC-prod
        - docker run -it --name LHCbDIRAC_certif_client --mount type=bind,source=/tmp/LHCbDIRACCertif/prod/DIRAC,target=/code/DIRAC --mount type=bind,source=/tmp/LHCbDIRACCertif/prod/LHCbDIRAC,target=/code/LHCbDIRAC -v /cvmfs:/cvmfs:shared almalinux
        - PS1="\[\033[44m\]\[\033[22m\]\u@PROD_CLIENT\[\033[00m\] $ " && export GIT_SSL_NO_VERIFY=1 && mkdir client && cd client && curl -LO https://github.com/DIRACGrid/DIRACOS2/releases/latest/download/DIRACOS-Linux-$(uname -m).sh && bash DIRACOS-Linux-$(uname -m).sh && rm -Rf DIRACOS-Linux-$(uname -m).sh && source diracos/diracosrc && cd .. && pip install LHCbDIRAC && mkdir ~/.globus
        - pip install git+https://gitlab.cern.ch/lhcb-simulation/lbmcsubmit.git
  - window_name: servers
    layout: tiled
    panes:
      - shell_command:
        - sshpass -f /tmp/.passwd ssh lhcbvoboxcertif00.cern.ch
        - PS1="\[\033[0;31m\]\u@\[\033[0;32m\]\h:\[\033[0;36m\]\w $ \[\033[0m\]" && cd /opt/dirac
        - clear
      - shell_command:
        - sshpass -f /tmp/.passwd ssh lhcbvoboxcertif01.cern.ch
        - PS1="\[\033[0;31m\]\u@\[\033[0;32m\]\h:\[\033[0;36m\]\w $ \[\033[0m\]" && cd /opt/dirac
        - clear
